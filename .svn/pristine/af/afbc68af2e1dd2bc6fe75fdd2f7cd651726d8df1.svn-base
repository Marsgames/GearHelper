local L = LibStub("AceLocale-3.0"):GetLocale("GearHelper")

local function GetInvMsg(info, val)
    return GearHelper.db.profile.inviteMessage
end

local ghOptionsTable = {
    name = "GearHelper",
    type = "group",
    childGroups  = "select",
    args = {
        group1 = {
            order = 0,
            name = " ",
            type = "group",
            inline = true,
            args = {
                enable = {
                    order = 0,
                    name = "Enable GearHelper",
                    desc = L["UIGHCheckBoxAddon"],
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.addonEnabled = val; if val == false then PlaySoundFile("sound\\Creature\\Malfurion_Stormrage\\VO_703_Malfurion_Stormrage_37.ogg", "MASTER") end end,
                    get = function(info) return GearHelper.db.profile.addonEnabled end
                },
                debug = {
                    order = 1,
                    name = "Debug",
                    desc = L["UIGHCheckBoxAddon"],
                    type = "toggle",
                    set = function(info,val) end,
                    get = function(info) end
                }
            }
        },
        spacer1  = {
            order = 1,
            name = "Gear Options",
            type = "header",
        },
        group2 = {
            order = 2,
            name = " ",
            type = "group",
            inline = true,
            args = {
                autoGreed = {
                    order = 2,
                    name = "Greed",
                    desc = L["UIGHCheckBoxAutoGreed"],
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.autoGreed = val end,
                    get = function(info) return GearHelper.db.profile.autoGreed end
                },
                autoNeed = {
                    order = 3,
                    name = "Need",
                    desc = L["UIGHCheckBoxAutoNeed"],
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.autoNeed = val end,
                    get = function(info) return GearHelper.db.profile.autoNeed end
                },
                autoEquipLootedStuff = {
                    order = 4,
                    name = "Auto equip looted stuff",
                    desc = L["UIGHCheckBoxAutoEquipLootedStuff"],
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.autoEquipLooted.actual = val end,
                    get = function(info) return GearHelper.db.profile.autoEquipLooted.actual end
                },
                autoEquipWhenSwitchSpe = {
                    order = 7,
                    name = "Spec Switch",
                    desc = L["UIGHCheckBoxAutoEquipWhenSwitchSpe"],
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.autoEquipWhenSwitchSpe = val end,
                    get = function(info) return GearHelper.db.profile.autoEquipWhenSwitchSpe end
                },
                askLootRaid = {
                    order = 6,
                    name = "Loot in raid",
                    desc = "Enables / disables ask for loot in raid",
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.askLootRaid = val end,
                    get = function(info) return GearHelper.db.profile.askLootRaid end
                },
                printWhenEquip = {
                    order = 5,
                    name = "Print When Equip",
                    desc = "Enables / disables print when equip",
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.printWhenEquip = val end,
                    get = function(info) return GearHelper.db.profile.printWhenEquip end
                }
            }
        },
        spacer2 = {
            order = 3,
            name = "Misc Options",
            type = "header",
        },
        group3 = {
            order = 4,
            name = " ",
            type = "group",
            inline = true,
            args = {
                autoSell = {
                    order = 0,
                    name = "Sell Grey Items",
                    desc = L["UIGHCheckBoxSellGrey"],
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.sellGreyItems = val end,
                    get = function(info) return GearHelper.db.profile.sellGreyItems end
                },
                autoAcceptQuestReward = {
                    order = 1,
                    name = "Quests Rewards",
                    desc = L["UIGHCheckBoxAutoAcceptQuestReward"],
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.autoAcceptQuestReward = val end,
                    get = function(info) return GearHelper.db.profile.autoAcceptQuestReward end
                },
                autoRepair = {
                    order = 2,
                    name = "Auto-Repair",
                    desc = "Enables / disables automatic reparation",
                    type = "select",
                    values = {
                        [0] = "Do Not Repair",
                        [1] = "Repair with own gold",
                        [2] = "Repair with guild gold",
                    },
                    set = function(info,val) GearHelper.db.profile.autoRepair = val end,
                    get = function(info) return GearHelper.db.profile.autoRepair end,
                    style = "dropdown",
                },
                autoTell = {
                    order = 3,
                    name = "Loot Announcement",
                    desc = L["checkGHAutoTell"],
                    type = "toggle",
                    width = "full",
                    set = function(info,val) GearHelper.db.profile.autoTell = val end,
                    get = function(info) return GearHelper.db.profile.autoTell end
                },
                autoInvite = {
                    order = 4,
                    name = "Invite On Whisper",
                    desc = function(info, vak) return L["UIGHCheckBoxAutoInvite"]..GetInvMsg(info, val) end,
                    type = "toggle",
                    set = function(info,val) GearHelper.db.profile.autoInvite = val end,
                    get = function(info) return GearHelper.db.profile.autoInvite end
                },
                inviteMessage = {
                    order = 5,
                    name = "Invite Message",
                    desc = "Invite message to tell you to be invited",
                    type = "input",
                    --set = function(info,val) GearHelper.db.profile.inviteMessage = val end,
                    set = function(info,val) GearHelper:setInviteMessage(val) end,
                    get = function(info) return GearHelper.db.profile.inviteMessage end
                },
            }
        },
        -- moreoptions={
        --   name = "More Options",
        --   type = "group",
        --   args={
        --     -- more options go here
        --   }
        -- }
    }
}


local function GetSelectCW(info, val)
    if GearHelper.db.profile.weightTemplate == "NOX" then
        return 1
    elseif GearHelper.db.profile.weightTemplate == "CW" then
        return 0
    end

    -- InterfaceOptionsFrame:Hide()
    -- InterfaceOptionsFrame:Show()
    -- InterfaceOptionsFrame_OpenToCategory(GearHelper.optionsFrame)

end
local function SetSelectCW(info, val)
    local currentSpec = tostring(GetSpecializationInfo(GetSpecialization()))

    if val == 0 then
        GearHelper.db.profile.weightTemplate = "CW"
        if not GearHelper.db.profile.CW[(currentSpec)] then
            GearHelper.db.profile.CW[(currentSpec)] = GearHelper.db.global.templates[(currentSpec)]["NOX"]
        end
    elseif val == 1 then
        GearHelper.db.profile.weightTemplate = "NOX"
    end
end
local function ResetCW()
    local currentSpec = tostring(GetSpecializationInfo(GetSpecialization()))
    GearHelper.db.profile.CW[(currentSpec)] = GearHelper.db.global.templates[(currentSpec)]["NOX"]
end
local function GetStat(info, stat)
    local currentSpec = tostring(GetSpecializationInfo(GetSpecialization()))
    if GearHelper.db.profile.weightTemplate == "CW" then
        return tostring(GearHelper.db.profile.CW[(currentSpec)][stat])
    else
        return tostring(GearHelper.db.global.templates[(currentSpec)]["NOX"][stat])
    end
end
local function SetStat(info, val, stat)
    local currentSpec = tostring(GetSpecializationInfo(GetSpecialization()))
    if GearHelper.db.profile.weightTemplate == "CW" then
        GearHelper.db.profile.CW[(currentSpec)][stat] = val
        if not GearHelper.db.global.templates[(currentSpec)]["CW"] then
            GearHelper.db.global.templates[(currentSpec)]["CW"] = {}
        end
        GearHelper.db.global.templates[(currentSpec)]["CW"][stat] = val
        return tostring(GearHelper.db.profile.CW[(currentSpec)][stat])
    else
        -- GearHelper.db.global.templates[(currentSpec)]["NOX"][stat] = val
        -- return tostring(GearHelper.db.global.templates[(currentSpec)]["NOX"][stat])
    end
end
local cwTable = {
    name = "Custom Weights",
    type = "group",
    childGroups = "tree",
    args  = {
        Select = {
            order = 0,
            name = "Stats Template",
            type = "select",
            style = "radio",
            values = {
                [0] = "Custom Weights",
                [1] = "Noxxic Weights"
            },
            get = function(info, val) return GetSelectCW(info, val) end,
            set = function(info, val) return SetSelectCW(info, val) end,
        },
        Intell = {
            order = 1,
            name = "Intell",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Intellect") == "0" then return true end end,
            get = function(info) return GetStat(info, "Intellect") end,
            set = function(info, val) return SetStat(info, val, "Intellect") end,
        },
        Strength = {
            order = 2,
            name = "Force",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Strength") == "0" then return true end end,
            get = function(info) return GetStat(info, "Strength") end,
            set = function(info, val) return SetStat(info, val, "Strength") end,
        },
        Agility = {
            order = 3,
            name = "Agi",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Agility") == "0" then return true end end,
            get = function(info) return GetStat(info, "Agility") end,
            set = function(info, val) return SetStat(info, val, "Agility") end,
        },
        Stamina = {
            order = 4,
            name = "Endu",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Stamina") == "0" then return true end end,
            get = function(info) return GetStat(info, "Stamina") end,
            set = function(info, val) return SetStat(info, val, "Stamina") end,
        },
        Haste = {
            order = 5,
            name = "Hate",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Haste") == "0" then return true end end,
            get = function(info) return GetStat(info, "Haste") end,
            set = function(info, val) return SetStat(info, val, "Haste") end,
        },
        Mastery = {
            order = 6,
            name = "Maitrise",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Mastery") == "0" then return true end end,
            get = function(info) return GetStat(info, "Mastery") end,
            set = function(info, val) return SetStat(info, val, "Mastery") end,
        },
        Critic = {
            order = 7,
            name = "Crit",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "CriticalStrike") == "0" then return true end end,
            get = function(info) return GetStat(info, "CriticalStrike") end,
            set = function(info, val) return SetStat(info, val, "CriticalStrike") end,
        },
        Armor = {
            order = 8,
            name = "Armure",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Armor") == "0" then return true end end,
            get = function(info) return GetStat(info, "Armor") end,
            set = function(info, val) return SetStat(info, val, "Armor") end,
        },
        Versatility = {
            order = 9,
            name = "Polyvalence",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Versatility") == "0" then return true end end,
            get = function(info) return GetStat(info, "Versatility") end,
            set = function(info, val) return SetStat(info, val, "Versatility") end,
        },
        Leech = {
            order = 10,
            name = "Ponction",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Leech") == "0" then return true end end,
            get = function(info) return GetStat(info, "Leech") end,
            set = function(info, val) return SetStat(info, val, "Leech") end,
        },
        Avoidance= {
            order = 11,
            name = "Evitement",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "Avoidance") == "0" then return true end end,
            get = function(info) return GetStat(info, "Avoidance") end,
            set = function(info, val) return SetStat(info, val, "Avoidance") end,
        },
        MainHandDamage= {
            order = 12,
            name = "Dégats main droite",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "MainHandDps") == "0" then return true end end,
            get = function(info) return GetStat(info, "MainHandDps") end,
            set = function(info, val) return SetStat(info, val, "MainHandDps") end,
        },
        OffHandDamage = {
            order = 13,
            name = "Dégats main gauche",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "OffHandDps") == "0" then return true end end,
            get = function(info) return GetStat(info, "OffHandDps") end,
            set = function(info, val) return SetStat(info, val, "OffHandDps") end,
        },
        MovementSpeed= {
            order = 14,
            name = "Vitesse",
            type = "input",
            disabled = function() if GearHelper.db.profile.weightTemplate == "NOX" then return true end end,
            hidden = function(info) if GearHelper.db.profile.weightTemplate == "NOX" and GetStat(info, "MovementSpeed") == "0" then return true end end,
            get = function(info) return GetStat(info, "MovementSpeed") end,
            set = function(info, val) return SetStat(info, val, "MovementSpeed") end,
        },
        Reset = {
            order = 15,
            name = "Reset",
            type = "execute",
            hidden = function() if GearHelper.db.profile.weightTemplate ~= "CW" then return true end end,
            func = function() ResetCW() end,
        }
    }
}


local aboutTable = {
    name = "About",
    type = "group",
    args  = {
        version = {
            order = 0,
            fontSize = "medium",
            name = "\n\n\n\n\n                |cFFFFFF00Version :|r "..version..--[[4124.27.0.2.0.31]]"\n",
            type = "description",
        },
        author = {
            order =  1,
            fontSize = "medium",
            name = "                |cFFFFFF00Author :|r Marsgames - Temple Noir\n                               Tempaxe - Temple Noir"..--[[Ta mère]]" \n",
            type = "description",
        },
        email = {
            order =  2,
            fontSize = "medium",
            name = "                |cFFFFFF00E-Mail :|r marsgames@gmail.com"..--[[fdp@fdp.land]]" \n",
            type = "description",
        },
        bug = {
            order =  3,
            fontSize = "medium",
            name = "                |cFFFFFF00BugReport :|r https://wow.curseforge.com/projects/gearhelper/issues \n",
            type = "description",
        },
        credits = {
            order =  4,
            fontSize = "medium",
            name = "                |cFFFFFF00Credits :|r A leurs tantes les putes\n",
            type = "description",
        },
    }
}

LibStub("AceConfig-3.0"):RegisterOptionsTable("GearHelper", ghOptionsTable, "ghOption")
LibStub("AceConfig-3.0"):RegisterOptionsTable("Custom Weights", cwTable)
LibStub("AceConfig-3.0"):RegisterOptionsTable("About", aboutTable)

GearHelper.optionsFrame = LibStub("AceConfigDialog-3.0"):AddToBlizOptions("GearHelper")
GearHelper.cwFrame = LibStub("AceConfigDialog-3.0"):AddToBlizOptions("Custom Weights", "Custom Weights", "GearHelper")
LibStub("AceConfigDialog-3.0"):AddToBlizOptions("About", "About", "GearHelper")
